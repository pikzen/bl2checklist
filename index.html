<!doctype html>
<html>
	<head>
		<title>Borderlands 2 Checklist</title>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="styles/main.css">
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
	</head>
	<body>
		<h1>Borderlands 2 Checklist</h1>

		<div class="search-bar">
			<input type="text" placeholder="Search // Not Working">
		</div>

		<div id="legendary-list" class="list">
			<h2 class="header legendaries">Legendaries</h2>
		</div>
		<div id="uniques-list" class="list">
			<h2 class="header uniques">Uniques</h2>
		</div>

		<div id="seraph-list" class="list">
			<h2 class="header seraph">Seraph</h2>
		</div>
		<div id="pearl-list" class="list">
			<h2 class="header pearl">Pearlescent</h2>
		</div>
		<div id="etech-list" class="list">
			<h2 class="header etech">E-Tech</h2>
		</div>
		<template id="item">
			<div class="item">
				<h2 class="item-name">Item Name</h2>
				<div class="overlay"></div>
				<img src="" class="item-image">
				<h3 class="item-flair">Cold in April</h3>
				<div class="got-it"><div class="custom-checkbox">âœ“</div>Obtenu !</div>
			</div>
		</template>

		<script type="text/javascript">
			var itemList = [
				{
					name: "legendary",
					items: [
						{
							name: "Striker",
							flair: "Fandir? Thirteen.",
							id: 1
						},
						{
							name: "Deliverance",
							flair: "Kiki got a shotgun",
							id: 2
						}
					]
				},
				{
					name: "uniques",
					items: [
						{
							name: 'Fibber',
							flair: 'Would I lie to you?',
							id: 5
						},
						{
							name: 'Flynt\'s Tinderbox',
							flair: 'Good for starting fires',
							id: 6
						},
						{
							name: 'Greed',
							flair: 'Thief.',
							id: 7
						}
					]
				},
				{
					name: "seraph",
					items: [
						{
							name: 'Devastator',
							flair: 'Hail.',
							id: 4
						}
					]
				},
				{
					name: "pearl",
					items: [
						{
							name: 'Stalker',
							flair: 'You can run, but you can\'t hide',
							id: 8
						}
					]
				},
				{
					name: "etech",
					items: [
						{
							name: 'Dahlminator',
							flair: 'Dodge this.',
							id: 3
						}
					]
				},

			];

			var t = document.querySelector('#item');
			var clone = document.importNode(t.content, true);

			for (var key in itemList) {
				var target = "#" + itemList[key].name + "-list";
				var domElement = document.querySelector(target);

				for (var i in itemList[key].items) {
					var clone = document.importNode(t.content, true);
					var id = itemList[key].items[i].id;
					clone.querySelector('.item').setAttribute("data-weapon-id", id);
					clone.querySelector('.item-name').textContent = itemList[key].items[i].name;
					clone.querySelector('.item-flair').textContent = itemList[key].items[i].flair;

					(function(_id, _clone) {
						clone.querySelector('.got-it').addEventListener("click", function() {
							if (!this.classList.contains('really')) {
							  	this.classList.add("really");
							  	_clone.setAttribute("data-weapon-owned", true);
							}
							else {
								this.classList.remove('really');
								_clone.setAttribute("data-weapon-owned", false);
							}

							var ownedItems = localStorage.getItem('owned') ? JSON.parse(localStorage.getItem('owned')) : {};
							ownedItems[_id] = !ownedItems[_id];
							localStorage.setItem('owned', JSON.stringify(ownedItems));
						});
					})(id, clone.querySelector('.item'));

					domElement.appendChild(clone);
				}
			}

			var ownedItems = localStorage.getItem('owned') ? JSON.parse(localStorage.getItem('owned')) : {};
			for (var i in ownedItems) {
				var target = document.querySelector('.item[data-weapon-id="' + i + '"]');
				if (ownedItems[i]) {
					target.querySelector('.got-it').classList.add('really');
					target.setAttribute('data-weapon-owned',true);
				}
				else {
					target.setAttribute('data-weapon-owned',false);
				}
			}

			console.log(document.querySelectorAll('.item'))
			var elements = document.querySelectorAll('.item');

			for (var i = 0; i < elements.length; i++) {

				if (!elements[i].getAttribute('data-weapon-owned')) {
					elements[i].setAttribute('data-weapon-owned', false);
				}
			}
		</script>
	</body>
</html>